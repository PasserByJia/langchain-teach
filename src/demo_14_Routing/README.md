# Demo 14: 使用自定义函数进行路由

这个 `demo` 展示了如何在 LangChain 表达式语言（LCEL）中实现路由，创建一个非确定性的链。在这种链中，前一个步骤的输出将决定下一个要执行的步骤。

## 功能

路由功能允许你根据不同的输入，动态地选择不同的处理逻辑或链分支。这对于构建能够根据用户意图调用不同工具或知识库的复杂智能体（Agent）非常有用。

本 `demo` 通过一个自定义函数（`route`）来实现路由，整个流程分为四步：

1.  **分类链 (`classificationChain`)**: 首先，使用一个简单的语言模型链来分析用户的问题，并将其分类为 `LangChain`、`Anthropic` 或 `Other` 中的一种。
2.  **专家链**: 接着，为每个类别定义一个“专家”链。例如，`langChainChain` 被设定为一个 LangChain 领域的专家，它的回答会有特定的前缀。
3.  **路由函数 (`route`)**: 这是实现路由的核心。这个函数接收分类链的输出（`topic`）和原始问题（`question`），然后根据 `topic` 的内容，返回一个对应的专家链。
4.  **完整链 (`fullChain`)**: 最后，使用 `RunnableSequence` 将分类链和路由函数组合在一起。首先并行运行分类链和传递原始问题，然后将其输出传递给 `route` 函数，由 `route` 函数选择并执行最终的链。

## 如何运行

1.  确保你已经安装了所有必要的依赖项：

    ```bash
    npm install
    ```

2.  执行 `index.ts` 文件：

    ```bash
    npx ts-node src/demo_14_Routing/index.ts
    ```

## 适用场景

- **基于意图的工具选择**: 在一个智能体（Agent）中，你可以先用一个分类器来判断用户的意图（例如，“查询天气”、“订机票”或“闲聊”），然后路由到相应的工具或服务链来处理请求。
- **多知识库问答**: 如果你的应用连接了多个不同的知识库（例如，一个关于产品文档的，一个关于公司政策的），你可以先判断用户问题与哪个知识库最相关，然后将问题路由到对应的 RAG (检索增强生成) 链。
- **构建有限状态机**: 路由是构建基于语言模型的有限状态机（FSM）的基础。每个状态可以是一个链，而路由逻辑则决定了在接收到用户输入后，应该从当前状态转换到哪个新状态。
- **提供定制化回复**: 正如本 `demo` 所示，你可以根据问题的不同类别，提供不同风格或角色的回复，从而提升用户体验。